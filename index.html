<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Score Card</title>
    <style>
        table {
            /* width: 100%; */
            /* width: 100%; */
            border-collapse: collapse;
            text-align: center;
        }


        th,

        td {
            border: 1px solid black;
            padding: 0;
        }


        .color-cell {
            height: 30px;
        }


        input {
            /* width: 100%; */
            /* width: 100%; */
            height: 100%;
            text-align: center;
            border: none;
            box-sizing: border-box;
        }


        button {
            margin: 10px;
            padding: 5px 10px;
            font-size: 16px;
        }

        * {
            box-sizing: border-box;
        }

        /* Button used to open the contact form - fixed at the bottom of the page */
        .open-button {
            background-color: #555;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
            opacity: 0.8;
            position: fixed;
            bottom: 23px;
            right: 28px;
            width: 280px;
        }

        /* The popup form - hidden by default */
        .form-popup {
            display: none;
            position: fixed;
            border: 3px solid #f1f1f1;
            z-index: 9;
        }

        /* Add styles to the form container */
        .form-container {
            max-width: 300px;
            padding: 10px;
            background-color: white;
        }

        /* Full-width input fields */
        .form-container input[type=text],
        .form-container input[type=password] {
            width: 100%;
            padding: 15px;
            margin: 5px 0 22px 0;
            border: none;
            background: #f1f1f1;
        }

        /* When the inputs get focus, do something */
        .form-container input[type=text]:focus,
        .form-container input[type=password]:focus {
            background-color: #ddd;
            outline: none;
        }

        /* Set a style for the submit/login button */
        .form-container .btn {
            background-color: #04AA6D;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        /* Add a red background color to the cancel button */
        .form-container .cancel {
            background-color: red;
        }

        /* Add some hover effects to buttons */
        .form-container .btn:hover,
        .open-button:hover {
            opacity: 1;
        }
    </style>
</head>


<body onload="loadScores()">
    <h2>Heat Score Card</h2>
    <table>


        <!-- Score input rows -->
        <script>
            function updateTotal(player) {
                let total = 0;
                for (let round = 1; round <= 4; round++) {
                    let score = document.getElementById(`score${round}_${player}`).value;
                    total += parseInt(score) || 0;
                }
                document.getElementById(`total_${player}`).innerText = total;
            }


            document.addEventListener("DOMContentLoaded", function () {
                console.log("DOMContentLoaded");
                let table = document.querySelector("table");

                let nameRow = document.createElement("tr");
                for (let player = 1; player <= 8; player++) {
                    let cell = document.createElement("td");
                    cell.classList.add(`color-cell`);
                    cell.classList.add(`column${player}`);
                    cell.id = `name${player}`;
                    let colorIndex = player - 1;
                    cell.style.backgroundColor = colorValues[colorIndex];
                    cell.style.color = textColors[colorIndex];
                    cell.innerText = colorNames[colorIndex];
                    cell.onclick = function () { openForm(player); };
                    nameRow.appendChild(cell);
                }
                table.appendChild(nameRow);


                for (let round = 1; round <= 4; round++) {
                    let row = document.createElement("tr");
                    for (let player = 1; player <= 8; player++) {
                        let cell = document.createElement("td");
                        cell.classList.add(`column${player}`);
                        let input = document.createElement("input");
                        input.type = "number";
                        input.id = `score${round}_${player}`;
                        input.min = "0";
                        input.max = "9";
                        input.oninput = function () { updateTotal(player); };
                        cell.appendChild(input);
                        row.appendChild(cell);
                    }
                    table.appendChild(row);
                }


                // Add total row
                let totalRow = document.createElement("tr");
                for (let player = 1; player <= 8; player++) {
                    let cell = document.createElement("td");
                    cell.classList.add(`column${player}`);
                    cell.id = `total_${player}`;
                    cell.innerText = "0";
                    totalRow.appendChild(cell);
                }
                table.appendChild(totalRow);
            });

            function enterName(player) {
                let cell = document.getElementById(`name${player}`);
                if (cell) {
                    let name = prompt("Enter player name\n(Enter blank to remove column)", cell.innerText);
                    if (name) {
                        if (name.trim() == "") {
                            hideColumn(player);
                        } else {
                            document.getElementById(`name${player}`).innerText = name;
                        }
                        saveScores();
                    }
                }
            }

            function saveScores() {
                console.log("saveScores");
                let data = {};
                for (let player = 1; player <= 8; player++) {
                    let isHidden = document.querySelector(`.column${player}`).style.display === "none";
                    data[`hidden${player}`] = isHidden;
                    if (isHidden) continue;
                    data[`name${player}`] = document.getElementById(`name${player}`).innerText;
                    for (let round = 1; round <= 4; round++) {
                        let input = document.getElementById(`score${round}_${player}`);
                        if (input) {
                            data[`score${round}_${player}`] = input.value;
                        }
                    }
                }
                console.log(data);
                document.cookie = `scores=${JSON.stringify(data)}; path=/; max-age=31536000`;
                console.log(document.cookie);
            }

            function loadScores() {
                console.log("loadScores");
                console.log(document.cookie);
                let cookies = document.cookie.split('; ');
                console.log(cookies);
                let scores = cookies.find(row => row.startsWith('scores='));
                console.log(scores);
                if (scores) {
                    let data = JSON.parse(scores.split('=')[1]);
                    console.log(data);
                    for (let player = 1; player <= 8; player++) {
                        if (data[`name${player}`]) {
                            document.getElementById(`name${player}`).value = data[`name${player}`];
                        }
                        if (data[`hidden${player}`]) {
                            hideColumn(player);
                        }
                        for (let round = 1; round <= 4; round++) {
                            let input = document.getElementById(`score${round}_${player}`);
                            if (input && data[`score${round}_${player}`]) {
                                input.value = data[`score${round}_${player}`];
                            }
                        }
                        updateTotal(player);
                    }
                }
            }


            function hideColumn(c) {
                let columns = document.querySelectorAll(`.column${c}`);
                columns.forEach(col => {
                    col.style.display = "none";
                });
            }
            function showColumn(c) {
                let columns = document.querySelectorAll(`.column${c}`);
                columns.forEach(col => {
                    col.style.display = "table-cell";
                });
            }

            let colorNames = ["Yellow", "Blue", "Green", "Red", "Black", "Gray", "Orange", "Purple"];
            let colorValues = ["yellow", "blue", "green", "red", "black", "lightgray", "orange", "purple"];
            let textColors = ["black", "white", "white", "white", "white", "black", "black", "white"];

            function clearScores() {
                if (confirm("Are you sure you want to clear scores?")) {
                    for (let round = 1; round <= 4; round++) {
                        for (let player = 1; player <= 8; player++) {
                            document.getElementById(`score${round}_${player}`).value = "";
                        }
                        if (confirm("Are you sure you want to clear scores?")) {
                            for (let round = 1; round <= 4; round++) {
                                for (let player = 1; player <= 8; player++) {
                                    document.getElementById(`score${round}_${player}`).value = "";
                                }
                            }
                        }
                    }
                }
            }

            function clearNames() {
                if (confirm("Are you sure you want to clear the player names?")) {
                    for (let player = 1; player <= 8; player++) {

                        document.getElementById(`total_${player}`).innerText = "0";
                        // document.getElementById(`name${player}`).value = "";
                    }
                }
            }

            function openForm(player) {
                let cell = document.getElementById(`name${player}`);
                let form = document.getElementById("myForm");
                let formNameField = document.getElementById("formNameField");
                formNameField.value = cell.innerText;
                var colorButton = document.getElementById("colorButton");
                colorButton.style.backgroundColor = cell.style.backgroundColor;
                colorButton.style.color = cell.style.color;
                colorButton.onclick = function () {
                    let colorIndex = colorValues.indexOf(colorButton.style.backgroundColor);
                    colorIndex = (colorIndex + 1) % colorValues.length;
                    colorButton.style.backgroundColor = colorValues[colorIndex];
                    colorButton.style.color = textColors[colorIndex];
                    saveScores();
                };

                document.getElementById("removePlayer").onclick = function () {
                    hideColumn(player);
                    saveScores();
                    closeForm();
                };
                var playerFormSaveButton = document.getElementById("playerFormSaveButton");
                playerFormSaveButton.onclick = function () {
                    cell.innerText = formNameField.value;
                    cell.style.backgroundColor = colorButton.style.backgroundColor;
                    cell.style.color = colorButton.style.color;
                    saveScores();
                    closeForm();
                };

                // formNameField.style.backgroundColor = cell.style.backgroundColor;

                // set the form top-left to cell top left
                let rect = cell.getBoundingClientRect();
                form.style.top = `${rect.bottom}px`;
                form.style.left = `${rect.left}px`;

                form.style.display = "block";
            }

            function closeForm() {
                document.getElementById("myForm").style.display = "none";
            }


        </script>
    </table>
    <button onclick="clearScores()">Clear Scores</button>
    <button onclick="clearNames()">Clear Names</button>
    <button onclick="console.log('------------')">log</button>


    <!-- The form -->
    <div class="form-popup" id="myForm">
        <!-- <form action="/action_page.php" class="form-container"> -->
        <form class="form-container">
            <label for="name"><b>Player Name</b></label>
            <input id="formNameField" type="text" name="name" required>
            <button id="colorButton" type="button" class="btn" onclick="">Change Color</button>
            <button id="removePlayer" type="button" class="btn" onclick="">Remove Player</button>
            <button id="playerFormSaveButton" type="button" class="btn">Save</button>
            <button type="button" class="btn cancel" onclick="closeForm()">Cancel</button>
        </form>
    </div>
</body>


</html>